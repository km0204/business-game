<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä¼æ¥­æŠ•è³‡ãƒ“ã‚¸ãƒã‚¹ã‚²ãƒ¼ãƒ </title>
  <style>
    :root { --gap: 12px; }
    body { font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; margin: 0; background:#f6f7fb; color:#111; }
    header { padding: 14px 16px; background:#111827; color:#fff; position: sticky; top: 0; }
    header h1 { font-size: 16px; margin: 0; }
    main { padding: 14px 16px 90px; max-width: 820px; margin: 0 auto; }
    .card { background:#fff; border-radius: 14px; padding: 14px; box-shadow: 0 6px 18px rgba(0,0,0,.06); margin-bottom: 12px; }
    .grid { display: grid; gap: var(--gap); }
    .grid-2 { grid-template-columns: 1fr 1fr; }
    @media (max-width: 560px) { .grid-2 { grid-template-columns: 1fr; } }
    .row { display:flex; gap: var(--gap); align-items: center; flex-wrap: wrap; }
    label { font-size: 12px; color:#374151; display:block; margin-bottom: 6px; }
    input[type="number"], input[type="text"] {
      width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 16px; background:#fff;
    }
    .hint { font-size: 12px; color:#6b7280; margin-top: 6px; }
    .pill { display:inline-flex; align-items:center; gap: 6px; padding: 6px 10px; border-radius: 999px; background:#eef2ff; color:#3730a3; font-size: 12px; }
    .kpi { display:flex; gap: 10px; flex-wrap: wrap; }
    .kpi .box { flex: 1; min-width: 180px; background:#f9fafb; border:1px solid #e5e7eb; border-radius: 14px; padding: 12px; }
    .kpi .box .t { font-size: 12px; color:#6b7280; }
    .kpi .box .v { font-size: 20px; font-weight: 700; margin-top: 6px; }
    button {
      padding: 12px 14px; border: 0; border-radius: 14px; font-size: 16px; font-weight: 700;
      background:#2563eb; color:#fff; cursor: pointer;
    }
    button.secondary { background:#111827; }
    button.ghost { background:#e5e7eb; color:#111; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 8px; border-bottom: 1px solid #eef2f7; text-align: right; }
    th { text-align: right; font-size: 12px; color:#6b7280; }
    th:first-child, td:first-child { text-align: left; }
    .ok { color:#065f46; font-weight: 700; }
    .ng { color:#991b1b; font-weight: 700; }
    .footerbar {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: rgba(246,247,251,.92); backdrop-filter: blur(8px);
      border-top: 1px solid #e5e7eb;
      padding: 10px 12px;
    }
    .footerbar .wrap { max-width: 820px; margin: 0 auto; display:flex; gap: 10px; }
    .log { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; white-space: pre-wrap; background:#0b1020; color:#e5e7eb; border-radius: 14px; padding: 12px; }
    .small { font-size: 12px; color:#6b7280; }
  </style>
</head>
<body>
<header>
  <h1>ä¼æ¥­æŠ•è³‡ãƒ“ã‚¸ãƒã‚¹ã‚²ãƒ¼ãƒ ï¼ˆãƒ­ãƒ¼ã‚«ãƒ« / ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰</h1>
</header>

<main>
  <div class="card">
    <div class="kpi">
      <div class="box">
        <div class="t">åˆæœŸè³‡é‡‘</div>
        <div class="v" id="kpiInitial">Â¥1,000,000</div>
      </div>
      <div class="box">
        <div class="t">ç¾åœ¨ã®ç·è³‡ç”£ï¼ˆæŠ•è³‡åˆè¨ˆï¼‰</div>
        <div class="v" id="kpiTotal">Â¥0</div>
      </div>
      <div class="box">
        <div class="t">ã‚¤ãƒ™ãƒ³ãƒˆå›æ•°</div>
        <div class="v" id="kpiRound">0</div>
      </div>
    </div>
    <div class="hint">â€» ã“ã®ã‚²ãƒ¼ãƒ ã¯ã€ŒæŠ•è³‡é¡ã®å¢—æ¸›è¨ˆç®—ã€ã ã‘ã‚’è¡Œã„ã¾ã™ã€‚ç¾é‡‘ãƒ»æœªæŠ•è³‡æ®‹é«˜ã®æ¦‚å¿µãŒå¿…è¦ãªã‚‰å¾Œã§è¿½åŠ ã§ãã¾ã™ã€‚</div>
  </div>

  <div class="card">
    <div class="row" style="justify-content: space-between;">
      <div class="row">
        <span class="pill">â‘  æŠ•è³‡é¡ã‚’å…¥åŠ› â†’ â‘¡ æŠ•è³‡ã‚’ç¢ºå®š â†’ â‘¢ ã‚¤ãƒ™ãƒ³ãƒˆç•ªå· â†’ â‘£ ã‚¤ãƒ™ãƒ³ãƒˆé©ç”¨</span>
      </div>
      <div class="row">
        <span class="small">é€šè²¨: å†† / ç«¯æ•°: å››æ¨äº”å…¥</span>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px; font-size: 15px;">1) æŠ•è³‡é¡å…¥åŠ›ï¼ˆ8ä¼æ¥­ï¼‰</h2>
    <div class="grid grid-2" id="companyInputs"></div>
    <div class="hint" id="minHint"></div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px; font-size: 15px;">2) ã‚¤ãƒ™ãƒ³ãƒˆé©ç”¨</h2>
    <div class="grid grid-2">
      <div>
        <label for="eventNo">ã‚¤ãƒ™ãƒ³ãƒˆç•ªå·ï¼ˆ1ã€œ10ï¼‰</label>
        <input id="eventNo" type="number" min="1" max="10" inputmode="numeric" placeholder="ä¾‹: 3" />
        <div class="hint">å¸ä¼šã‹ã‚‰æŒ‡å®šã•ã‚ŒãŸç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>
      </div>
      <div>
        <label>ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­èº«ï¼ˆç¢ºèªç”¨ï¼‰</label>
        <input id="eventDesc" type="text" readonly />
        <div class="hint">ç•ªå·ã‚’å…¥ã‚Œã‚‹ã¨ã€å„ç¤¾ã®å¢—æ¸›ç‡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
      </div>
    </div>

    <div class="row" style="margin-top: 12px;">
      <button id="btnApply" disabled>ã‚¤ãƒ™ãƒ³ãƒˆé©ç”¨</button>
      <button class="ghost" id="btnNewRound">æ–°ã—ã„ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ˆæŠ•è³‡é¡ã‚’å†å…¥åŠ›ï¼‰</button>
      <button class="secondary" id="btnReset">å…¨ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <div class="hint">â€»ã€ŒæŠ•è³‡ã‚’ç¢ºå®šã€ã—ã¦ã„ãªã„çŠ¶æ…‹ã§ã¯ã‚¤ãƒ™ãƒ³ãƒˆé©ç”¨ã§ãã¾ã›ã‚“ã€‚</div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px; font-size: 15px;">ç¾åœ¨ã®æŠ•è³‡çŠ¶æ³</h2>
    <div style="overflow:auto;">
      <table>
        <thead>
          <tr>
            <th>ä¼æ¥­</th>
            <th>æœ€ä½æŠ•è³‡é¡</th>
            <th>ç¾åœ¨ã®æŠ•è³‡é¡</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot>
          <tr>
            <th>åˆè¨ˆ</th>
            <th></th>
            <th id="tableTotal">Â¥0</th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px; font-size: 15px;">å±¥æ­´ãƒ­ã‚°</h2>
    <div class="log" id="log"></div>
  </div>
</main>

<div class="footerbar">
  <div class="wrap">
    <button id="btnConfirm">æŠ•è³‡ã‚’ç¢ºå®š</button>
    <button class="ghost" id="btnShowEvents">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</button>
  </div>
</div>

<script>
(() => {
  // ====== è¨­å®š ======
  const INITIAL_CASH = 1_000_000; // åˆæœŸè³‡é‡‘ï¼ˆä»Šå›ã¯100ä¸‡å††å›ºå®šï¼‰
  const companies = [
    { id: "A", name: "ä¼æ¥­A", min: 50_000 },
    { id: "B", name: "ä¼æ¥­B", min: 50_000 },
    { id: "C", name: "ä¼æ¥­C", min: 30_000 },
    { id: "D", name: "ä¼æ¥­D", min: 30_000 },
    { id: "E", name: "ä¼æ¥­E", min: 10_000 },
    { id: "F", name: "ä¼æ¥­F", min: 10_000 },
    { id: "G", name: "ä¼æ¥­G", min: 10_000 },
    { id: "H", name: "ä¼æ¥­H", min: 10_000 },
  ];

  // ã‚¤ãƒ™ãƒ³ãƒˆ10ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå„ä¼æ¥­ã”ã¨ã®å¢—æ¸›ç‡ï¼‰
  // ä¾‹: +0.10 ã¯ +10%ã€-0.20 ã¯ -20%
  const events = [
    { no: 1, title: "å¥½æ™¯æ°—", rates: {A: 0.10, B: 0.08, C: 0.06, D: 0.05, E: 0.03, F: 0.03, G: 0.02, H: 0.02} },
    { no: 2, title: "ä¸æ³",   rates: {A:-0.12, B:-0.10, C:-0.08, D:-0.07, E:-0.05, F:-0.05, G:-0.04, H:-0.04} },
    { no: 3, title: "Aç¤¾ãƒ‹ãƒ¥ãƒ¼ã‚¹", rates: {A: 0.20, B: 0.00, C: 0.00, D: 0.00, E:-0.02, F: 0.00, G: 0.00, H: 0.00} },
    { no: 4, title: "Bç¤¾ç‚ä¸Š", rates: {A: 0.00, B:-0.25, C: 0.03, D: 0.00, E: 0.00, F: 0.00, G: 0.00, H: 0.00} },
    { no: 5, title: "C&Dæ¥­ç•Œè¿½ã„é¢¨", rates:{A:0.00, B:0.00, C:0.12, D:0.10, E:0.00, F:0.00, G:-0.03, H:0.00} },
    { no: 6, title: "è¦åˆ¶å¼·åŒ–ï¼ˆEã€œHã«å½±éŸ¿ï¼‰", rates:{A:0.00, B:0.00, C:0.00, D:0.00, E:-0.10, F:-0.08, G:-0.06, H:-0.05} },
    { no: 7, title: "ç‚ºæ›¿ã®è¿½ã„é¢¨ï¼ˆè¼¸å‡ºç³»A,Bï¼‰", rates:{A:0.15, B:0.12, C:0.00, D:0.00, E:0.00, F:-0.02, G:0.00, H:0.00} },
    { no: 8, title: "åŸææ–™é«˜ï¼ˆè£½é€ ç³»C,Dï¼‰", rates:{A:0.00, B:0.00, C:-0.14, D:-0.12, E:0.00, F:0.02, G:0.00, H:0.00} },
    { no: 9, title: "æ–°æŠ€è¡“ãƒ–ãƒ¼ãƒ ï¼ˆå…¨ä½“å°å¹…ä¸Šã’ï¼‰", rates:{A:0.04, B:0.04, C:0.04, D:0.04, E:0.04, F:0.04, G:0.04, H:0.04} },
    { no:10, title: "å¸‚å ´ã‚·ãƒ§ãƒƒã‚¯ï¼ˆãƒ©ãƒ³ãƒ€ãƒ æƒ³å®šã®ä»£æ›¿ï¼‰", rates:{A:-0.06, B:-0.08, C:-0.05, D:-0.07, E:-0.10, F:-0.04, G:-0.09, H:-0.03} },
  ];

  // ====== çŠ¶æ…‹ ======
  let confirmed = false;
  let round = 0;
  const state = {
    initial: INITIAL_CASH,
    investments: Object.fromEntries(companies.map(c => [c.id, 0])),
  };

  // ====== DOM ======
  const elCompanyInputs = document.getElementById("companyInputs");
  const elMinHint = document.getElementById("minHint");
  const elTableBody = document.getElementById("tableBody");
  const elTableTotal = document.getElementById("tableTotal");
  const elLog = document.getElementById("log");

  const elKpiInitial = document.getElementById("kpiInitial");
  const elKpiTotal = document.getElementById("kpiTotal");
  const elKpiRound = document.getElementById("kpiRound");

  const btnConfirm = document.getElementById("btnConfirm");
  const btnApply = document.getElementById("btnApply");
  const btnReset = document.getElementById("btnReset");
  const btnNewRound = document.getElementById("btnNewRound");
  const btnShowEvents = document.getElementById("btnShowEvents");

  const inputEventNo = document.getElementById("eventNo");
  const inputEventDesc = document.getElementById("eventDesc");

  // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
  const yen = (n) => "Â¥" + Math.round(n).toLocaleString("ja-JP");
  const pct = (r) => (r >= 0 ? "+" : "") + Math.round(r * 100) + "%";

  const sumInvestments = () => companies.reduce((acc, c) => acc + (state.investments[c.id] || 0), 0);

  function setLog(text, append=true) {
    if (append) elLog.textContent = (elLog.textContent ? (elLog.textContent + "\n") : "") + text;
    else elLog.textContent = text;
  }

  function renderInputs() {
    elCompanyInputs.innerHTML = "";
    companies.forEach(c => {
      const wrap = document.createElement("div");
      wrap.innerHTML = `
        <label>${c.name}ï¼ˆæœ€ä½ ${yen(c.min)}ï¼‰</label>
        <input type="number" inputmode="numeric" min="0" step="1000"
               id="inv_${c.id}" placeholder="æŠ•è³‡é¡ï¼ˆå††ï¼‰" />
        <div class="hint">0 ã§ã‚‚OKï¼ˆæŠ•è³‡ã—ãªã„ï¼‰</div>
      `;
      elCompanyInputs.appendChild(wrap);
    });

    elMinHint.textContent = "æœ€ä½æŠ•è³‡é¡ã¯å…¥åŠ›ãƒã‚§ãƒƒã‚¯ã«ä½¿ã„ã¾ã™ï¼ˆ0ã¯æœªæŠ•è³‡æ‰±ã„ï¼‰ã€‚";
  }

  function renderTable() {
    elTableBody.innerHTML = "";
    companies.forEach(c => {
      const tr = document.createElement("tr");
      const v = state.investments[c.id] || 0;
      tr.innerHTML = `
        <td>${c.name}</td>
        <td>${yen(c.min)}</td>
        <td>${yen(v)}</td>
      `;
      elTableBody.appendChild(tr);
    });

    const total = sumInvestments();
    elTableTotal.textContent = yen(total);
    elKpiInitial.textContent = yen(state.initial);
    elKpiTotal.textContent = yen(total);
    elKpiRound.textContent = String(round);

    btnApply.disabled = !confirmed;
    btnConfirm.textContent = confirmed ? "æŠ•è³‡ã‚’ç¢ºå®šï¼ˆç¢ºå®šæ¸ˆã¿ï¼‰" : "æŠ•è³‡ã‚’ç¢ºå®š";
    btnConfirm.disabled = confirmed;
  }

  function validateAndConfirm() {
    const inputs = companies.map(c => {
      const el = document.getElementById(`inv_${c.id}`);
      const val = Number(el.value || 0);
      return { c, val };
    });

    // æœ€ä½æŠ•è³‡é¡ãƒã‚§ãƒƒã‚¯ï¼ˆ0ã¯æœªæŠ•è³‡ã¨ã—ã¦è¨±å¯ï¼‰
    const badMin = inputs.filter(x => x.val > 0 && x.val < x.c.min);
    if (badMin.length) {
      alert("æœ€ä½æŠ•è³‡é¡æœªæº€ã®ä¼æ¥­ãŒã‚ã‚Šã¾ã™:\n" + badMin.map(x => `${x.c.name}: ${yen(x.val)}ï¼ˆæœ€ä½ ${yen(x.c.min)}ï¼‰`).join("\n"));
      return;
    }

    // åˆæœŸè³‡é‡‘ã‚’è¶…ãˆãªã„ï¼ˆä»Šå›ã¯ç¾é‡‘æ¦‚å¿µãªã—ã§ã€ŒæŠ•è³‡åˆè¨ˆï¼è³‡ç”£ã€ã§ã‚‚OKã ãŒã€è¦ä»¶ã«æ²¿ã£ã¦ãƒã‚§ãƒƒã‚¯ï¼‰
    const total = inputs.reduce((a, x) => a + x.val, 0);
    if (total > state.initial) {
      alert(`æŠ•è³‡åˆè¨ˆãŒåˆæœŸè³‡é‡‘ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚\næŠ•è³‡åˆè¨ˆ: ${yen(total)} / åˆæœŸè³‡é‡‘: ${yen(state.initial)}`);
      return;
    }

    // ç¢ºå®š
    inputs.forEach(x => state.investments[x.c.id] = Math.round(x.val));
    confirmed = true;
    setLog(`âœ… æŠ•è³‡ç¢ºå®š: åˆè¨ˆ ${yen(sumInvestments())}ï¼ˆæœªæŠ•è³‡æ®‹: ${yen(state.initial - sumInvestments())}ï¼‰`);
    renderTable();
  }

  function getEvent(no) {
    return events.find(e => e.no === no) || null;
  }

  function describeEvent(e) {
    const parts = companies.map(c => `${c.id}${pct(e.rates[c.id] ?? 0)}`).join(" / ");
    return `${e.no}. ${e.title}ï¼ˆ${parts}ï¼‰`;
  }

  function applyEvent(no) {
    if (!confirmed) return;

    const e = getEvent(no);
    if (!e) {
      alert("ã‚¤ãƒ™ãƒ³ãƒˆç•ªå·ã¯ 1ã€œ10 ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    // é©ç”¨
    companies.forEach(c => {
      const r = e.rates[c.id] ?? 0;
      const before = state.investments[c.id] || 0;
      const after = Math.round(before * (1 + r));
      state.investments[c.id] = after;
    });

    round += 1;

    const total = sumInvestments();
    const line = `ğŸ² ã‚¤ãƒ™ãƒ³ãƒˆé©ç”¨ #${round}: ${describeEvent(e)}\n   â†’ ç·è³‡ç”£: ${yen(total)}`;
    setLog(line);

    renderTable();
  }

  function newRound() {
    confirmed = false;
    // å…¥åŠ›æ¬„ã‚’ç¾åœ¨å€¤ã§åŸ‹ã‚ã‚‹ï¼ˆæ¬¡ã®æŠ•è³‡é…åˆ†ã‚’è€ƒãˆã‚„ã™ã„ï¼‰
    companies.forEach(c => {
      const el = document.getElementById(`inv_${c.id}`);
      if (el) el.value = state.investments[c.id] || 0;
    });
    setLog("ğŸ“ æ–°ã—ã„ãƒ©ã‚¦ãƒ³ãƒ‰: æŠ•è³‡é¡ã‚’å†å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæŠ•è³‡ç¢ºå®šã™ã‚‹ã¨é©ç”¨ã•ã‚Œã¾ã™ï¼‰ã€‚");
    renderTable();
  }

  function resetAll() {
    if (!confirm("å…¨ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
    round = 0;
    confirmed = false;
    companies.forEach(c => state.investments[c.id] = 0);
    companies.forEach(c => {
      const el = document.getElementById(`inv_${c.id}`);
      if (el) el.value = "";
    });
    setLog("ğŸ”„ ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚æŠ•è³‡é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚", false);
    renderTable();
  }

  function showEvents() {
    const lines = events.map(e => describeEvent(e)).join("\n");
    alert("ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ï¼ˆ1ã€œ10ï¼‰\n\n" + lines);
  }

  // ====== ã‚¤ãƒ™ãƒ³ãƒˆ ======
  btnConfirm.addEventListener("click", validateAndConfirm);
  btnApply.addEventListener("click", () => applyEvent(Number(inputEventNo.value)));
  btnReset.addEventListener("click", resetAll);
  btnNewRound.addEventListener("click", newRound);
  btnShowEvents.addEventListener("click", showEvents);

  inputEventNo.addEventListener("input", () => {
    const no = Number(inputEventNo.value);
    const e = getEvent(no);
    inputEventDesc.value = e ? describeEvent(e) : "";
  });

  // ====== åˆæœŸåŒ– ======
  renderInputs();
  setLog("ğŸ“Œ æº–å‚™OKï¼šæŠ•è³‡é¡ã‚’å…¥åŠ›ã—ã¦ã€ŒæŠ•è³‡ã‚’ç¢ºå®šã€â†’ ã‚¤ãƒ™ãƒ³ãƒˆç•ªå·ã‚’å…¥åŠ›ã—ã¦ã€Œã‚¤ãƒ™ãƒ³ãƒˆé©ç”¨ã€", false);
  renderTable();

})();
</script>
</body>
</html>
